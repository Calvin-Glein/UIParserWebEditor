<!DOCTYPE HTML>
<html>

<head>
    <title>UI Parser</title>

    <script type="text/javascript" src="C:\Users\Glenn\Desktop\UI Parser\styles\interact.js"></script>
    <link rel="stylesheet" type="text/css" href="styles\semantic\semantic.css">
    <script type="text/javascript" src="styles\jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="styles\XMLScript.js"></script>
    <script type="text/javascript" src="styles\Download.js"></script>


    <style>
        #drag {
            /*       width: 25%;
            height: 20 rm;
            min-height: 6.5em;
            margin: 10%;
*/
            /*       background-color: #29e;
            color: white;*/
            /*   border-radius: 0.75em;
            padding: 4%;*/
            -webkit-transform: translate(0px, 0px);
            transform: translate(0px, 0px);
        }

        #drag-me::before {
            content: "#" attr(id);
            font-weight: bold;
        }

    </style>



</head>

<body>
    <div class="ui container" style="background-color: white; height: 100%;">
        <div class="ui grid" style="height: 100%;">
            <div class="four wide column" style="height: 100%; background-color: white; overflow:auto; ">
                <!-- <h2 class="ui header ">
                    <i class="cubes icon"></i>
                    <div class="content">
                        UI Parser
                    </div>
                </h2>

                <div class="ui middle aligned divided list">
                    <div class="item">
                        <button id="add_label" class="ui basic button fluid">
                          <i class="icon add"></i>
                          Add Label
                        </button>
                    </div>
                    <div class="item">
                        <button class="ui basic button fluid">
                          <i class="icon add"></i>
                          Add TextBox
                        </button>
                    </div>
                    <div class="item">
                        <button class="ui basic button fluid">
                          <i class="icon add"></i>
                          Add Button
                        </button>
                    </div>
                </div>-->
                <div style="margin-left: 10px;">
                    <br>

                    <h2 class="ui center aligned icon header">
                        <i class="cubes icon"></i>
                        <div class="content">
                            UI Parser
                            <div class="sub header">Design layouts on the fly.</div>
                        </div>
                    </h2>
                    <div class="ui vertical menu fluid">
                        <div class="item">
                            <div class="ui transparent icon input">
                                <input id="text_content" type="text" placeholder="Insert text">
                                <i class="pencil icon"></i>
                            </div>
                        </div>
                        <div class="ui form">
                            <div class="inline fields">
                                <div class="sixteen wide field">
                                    <div class="ui labeled input">
                                        <div class="ui label">
                                            Font Size
                                        </div>
                                        <input id="font-size_content" type="text" placeholder="20">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <a class="item" onclick="add_label()">
 Label
<div id="label_count" class="ui teal left pointing label">0</div>
</a>
                        <div class="ui form">
                            <div class="inline fields">
                                <div class="eight wide field">
                                    <div class="ui labeled input">
                                        <div class="ui label">
                                            Height
                                        </div>
                                        <input id="height_content" type="text" placeholder="20">
                                    </div>
                                </div>
                                <div class="eight wide field">
                                    <div class="ui labeled input">
                                        <div class="ui label">
                                            Width
                                        </div>
                                        <input id="width_content" type="text" placeholder="20">
                                    </div>
                                </div>
                            </div>
                        </div>





                        <a class="item" onclick="add_textfield()">
                            Textfield
                            <div id = "textfield_count" class="ui teal left pointing label">0</div>
                          </a>
                        <a class="item" onclick="add_button()">
                            Button
                            <div id = "button_count" class="ui teal left pointing label">0</div>
                          </a>

                    </div>
                    <br><br>

                    <table id="elementTable" class="ui celled table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Content</th>
                                <th>X</th>
                                <th>Y</th>
                                <th>Height</th>
                                <th>Width</th>
                                <th>FontSize</th>

                                <th></th>

                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Add an element</td>
                                <td>Add an element</td>
                                <td>Add an element</td>
                                <td>Add an element</td>
                                <td>Add an element</td>
                                <td>Add an element</td>
                                <td><button id="" class="negative ui button">Delete</button>
                                </td>
                            </tr>

                        </tbody>
                    </table>

                    <br><br><br>

                    <button id="" onclick="exportToXML()" class="ui button fluid">Export</button>



                </div>
            </div>
            <div class="twelve wide column" style="height: 794px; width: 1366px; background-color: lightgray; border: solid 5px; ">
                <div id="container" style="height: 768px; width: 1366px;" style="position: relative">
                    <div id="start" style="height: 100%;"></div>


                </div>
            </div>

        </div>


    </div>



    <script>
        var indexCounter = 0;
        var elements = [];


        function exportToXML() {
            var xml = new XMLWriter();
            xml.BeginNode("Elements");


            for (var i = 0; i < elements.length; i++) {

                if (elements[i].id != -1) {
                    xml.BeginNode("Element");
                    /**/
                    xml.BeginNode("Type");
                    xml.WriteString(elements[i].type.toString());
                    xml.EndNode();

                    xml.BeginNode("Text");
                    xml.WriteString(elements[i].text.toString());
                    xml.EndNode();

                    xml.BeginNode("XCoordinate");
                    xml.WriteString(elements[i].xCoordinate.toString());
                    xml.EndNode();

                    xml.BeginNode("YCoordinate");
                    xml.WriteString(elements[i].yCoordinate.toString());
                    xml.EndNode();

                    xml.BeginNode("FontSize");
                    xml.WriteString(elements[i].fontSize.toString());
                    xml.EndNode();

                    xml.BeginNode("Height");
                    xml.WriteString(elements[i].height.toString());
                    xml.EndNode();

                    xml.BeginNode("Width");
                    xml.WriteString(elements[i].width.toString());
                    xml.EndNode();
                    /**/
                    xml.EndNode();


                }


            }

            xml.EndNode();
            console.log(xml.ToString());

            downloadXML(xml.ToString(), 'elements.xml', 'text/plain');
        }

        function deleteElement(deleteID) {

            var indexInElementsArray = elements.findIndex(z => z.id == parseInt(deleteID));
            elements[indexInElementsArray].id = -1;

            var dragID = "drag" + deleteID;
            console.log("plus adder: " + dragID);
            $('#' + dragID).remove();

            populateTable();
        }

        function addElementToList(id, type, text, fontSize, width, height) {
            var elementToAdd = new ElementDataType(id, type, text, "0", "0", fontSize, width, height);
            elements.push(elementToAdd);
            populateTable();
        }

        function ElementDataType(id, type, text, xCoordinate, yCoordinate, fontSize, width, height) {
            this.id = id;
            this.type = type;
            this.text = text;
            this.xCoordinate = xCoordinate;
            this.yCoordinate = yCoordinate;
            this.fontSize = fontSize;
            this.width = width;
            this.height = height;
        }

        function populateTable() {
            var table = document.getElementById("elementTable");
            $("#elementTable tbody tr").remove()
            var t = "";
            for (var i = 0; i < elements.length; i++) {
                if (elements[i].id != -1) {
                    var tr = "<tr>";
                    tr += "<td>" + elements[i].type + "</td>";
                    tr += "<td>" + elements[i].text + "</td>";
                    tr += "<td>" + elements[i].xCoordinate + "</td>";
                    tr += "<td>" + elements[i].yCoordinate + "</td>";
                    tr += "<td>" + elements[i].height + "</td>";
                    tr += "<td>" + elements[i].width + "</td>";
                    tr += "<td>" + elements[i].fontSize + "</td>";
                    tr += "<td><button onclick = 'deleteElement(this.id)' id = " + elements[i].id + " class='negative ui button fluid'>Delete</button></td>";
                    tr += "</tr>";
                    t += tr;
                }
            }
            document.getElementById("elementTable").innerHTML += t;
        }

        function add_label() {
            /*    var text = document.getElementById('text_content').value;
                $("#start").append(' <div id="drag' + indexCounter + '" class="draggable" style = "position: absolute;"> <p id = "' + indexCounter + '"></p> <div class="" style = "font-size: 20px;"> ' + text + '</div></div>');
                var currentLabelCount = parseInt($('#label_count').html());
                label_count.innerHTML = currentLabelCount + 1;

                console.log(indexCounter);


                addElementToList(indexCounter, "label", text);
                indexCounter = indexCounter + 1;*/

            var text = document.getElementById('text_content').value;
            var width = document.getElementById('width_content').value;
            var height = document.getElementById('height_content').value;
            var fontSize = document.getElementById('font-size_content').value;


            var toBeAppended = ' <div id="drag' + indexCounter + '" class="draggable" style = "position: absolute;"> <p id = "' + indexCounter + '"></p> <div class="" style = "font-size: ' + fontSize + 'px; width : ' + width + 'px ; height : ' + height + 'px; "> ' + text + '</div></div>';

            $("#start").append(toBeAppended);

            console.log(toBeAppended);
            var currentLabelCount = parseInt($('#label_count').html());
            label_count.innerHTML = currentLabelCount + 1;


            addElementToList(indexCounter, "label", text, fontSize, width, height);
            indexCounter = indexCounter + 1;
        }

        function add_textfield() {
            var text = document.getElementById('text_content').value;
            var width = document.getElementById('width_content').value;
            var height = document.getElementById('height_content').value;
            var fontSize = document.getElementById('font-size_content').value;



            var toBeAppended = ' <div id="drag' + indexCounter + '" class="draggable" style = "position: absolute;"><p id = "' + indexCounter + '"></p> <div class=""><input style = "font-size: ' + fontSize + 'px; width : ' + width + 'px ; height : ' + height + 'px; " placeholder="' + text + '"></div></div>';

            $("#start").append(toBeAppended);

            /*    $("#start").append(' <div id="drag' + indexCounter + '" class="draggable" style = "position: absolute;"><p id = "' + indexCounter + '"></p> <div class=""><input style = "font-size: 20px;" type="text" placeholder="' + text + '"></div></div>');*/

            var currentTextfieldCount = parseInt($('#textfield_count').html());
            textfield_count.innerHTML = currentTextfieldCount + 1;

            addElementToList(indexCounter, "textfield", text, fontSize, width, height);
            indexCounter = indexCounter + 1;
        }


        function add_button() {
            var text = document.getElementById('text_content').value;
            var width = document.getElementById('width_content').value;
            var height = document.getElementById('height_content').value;
            var height = document.getElementById('height_content').value;
            var fontSize = document.getElementById('font-size_content').value;



            var toBeAppended = '<div id="drag' + indexCounter + '" class="draggable" style = "position: absolute;"><p id = "' + indexCounter + '"></p> <div class=""><button style = "font-size: ' + fontSize + 'px; width : ' + width + 'px ; height : ' + height + 'px; "      disabled>' + text + '</button></div>';

            $("#start").append(toBeAppended);


            /*   $("#start").append(' <div id="drag' + indexCounter + '" class="draggable" style = "position: absolute;"><p id = "' + indexCounter + '"></p> <div class=""><button style = "font-size: 20px;" class="" disabled>' + text + '</button></div>');*/
            var currentButtonCount = parseInt($('#button_count').html());
            button_count.innerHTML = currentButtonCount + 1;

            addElementToList(indexCounter, "button", text, fontSize, width, height);
            indexCounter = indexCounter + 1;
        }

    </script>

    <script>
        interact('.draggable')
            .draggable({
                // enable inertial throwing
                inertia: true,
                // keep the element within the area of it's parent
                restrict: {
                    restriction: "parent",
                    endOnly: true,
                    elementRect: {
                        top: 0,
                        left: 0,
                        bottom: 1,
                        right: 1
                    }
                },
                // enable autoScroll
                autoScroll: true,

                // call this function on every dragmove event
                onmove: dragMoveListener,
                // call this function on every dragend event
                onend: function(event) {
                    var textEl = event.target.querySelector('p');
                    var target = event.target
                    x = (parseFloat(target.getAttribute('data-x')));
                    y = (parseFloat(target.getAttribute('data-y')));

                    /*       textEl && (textEl.textContent =
                               textEl.textContent +
                               (Math.sqrt(event.dx * event.dx +
                                   event.dy * event.dy) | 0) + 'px' + " x: " + x + " y: " + y);
                           */


                }
            });

        function dragMoveListener(event) {
            var target = event.target,
                // keep the dragged position in the data-x/data-y attributes
                x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
                y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

            // translate the element
            target.style.webkitTransform =
                target.style.transform =
                'translate(' + x + 'px, ' + y + 'px)';

            // update the posiion attributes
            target.setAttribute('data-x', x);
            target.setAttribute('data-y', y);

            /*get id */
            /*pass data to populateTable*/
            var elementDraggedID = parseInt(event.target.querySelector('p').id);
            var indexInElementsArray = elements.findIndex(z => z.id == elementDraggedID)
            elements[indexInElementsArray].xCoordinate = Math.trunc(x);
            elements[indexInElementsArray].yCoordinate = Math.trunc(y);
            populateTable();

        }

        // this is used later in the resizing and gesture demos
        window.dragMoveListener = dragMoveListener;

    </script>

    <script>


    </script>



</body>

</html>
